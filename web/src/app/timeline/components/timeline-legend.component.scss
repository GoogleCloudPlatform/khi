/**
 * Copyright 2026 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@use "../../common.scss" as common;
@use "@angular/material" as mat;

@mixin revision-style-box($revisionColor, $borderThickness) {
  box-sizing: border-box;
  mat-icon {
    color: rgb(from $revisionColor calc(r * 0.6) calc(g * 0.6) calc(b * 0.6));
  }
  &.style-normal {
    $dark-color: rgb(
      from $revisionColor calc(r * 0.6) calc(g * 0.6) calc(b * 0.6)
    );
    background-color: color-mix(in srgb, $revisionColor, transparent 50%);
    border: $borderThickness solid $dark-color;
  }
  &.style-partial-info {
    $stripeBrighter: color-mix(in display-p3, $revisionColor 20%, white);
    $stripeBrighterTransparent: color-mix(
      in display-p3,
      $stripeBrighter,
      transparent 70%
    );
    background-image: repeating-linear-gradient(
      45deg,
      $stripeBrighterTransparent,
      $stripeBrighterTransparent 5px,
      color-mix(in display-p3, $revisionColor, transparent 70%) 5px,
      color-mix(in display-p3, $revisionColor, transparent 70%) 10px
    );
    $dark-color: rgb(
      from $revisionColor calc(r * 0.6) calc(g * 0.6) calc(b * 0.6)
    );
    border: $borderThickness solid $dark-color;
  }
  &.style-deleted {
    $dark-color: rgb(
      from $revisionColor calc(r * 0.6) calc(g * 0.6) calc(b * 0.6)
    );
    background-color: color-mix(in srgb, $revisionColor, transparent 70%);
    border: $borderThickness dashed $dark-color;
  }
}

:host {
  display: inline-block;
}

.container {
  pointer-events: all;
  @include mat.button-toggle-overrides(
    (
      height: 10px,
      label-text-line-height: 10px,
    )
  );
  @include mat.expansion-overrides(
    (
      header-text-line-height: 20px,
      header-text-size: 14px,
      header-collapsed-state-height: 30px,
      header-expanded-state-height: 30px,
    )
  );
}

.timeline-type {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 5px 0 5px 0;
  .label {
    color: var(--timeline-type-color);
    background-color: var(--timeline-type-background-color);
    padding: 0 5px;
    border-radius: 5px;
  }
}

.legend-type-title {
  display: flex;
  align-items: center;
  gap: 5px;
  color: #333;
  font-weight: 600;
}

.legend-container {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 5px 0 0 0;
}

.toggle-button-container {
  display: flex;
  justify-content: center;
}

.revision-rect {
  $size: 30px;
  width: $size;
  height: $size;
  @include revision-style-box(var(--revision-color), 3px);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--revision-color);
  mat-icon {
    @include common.adjust-mat-icon-size(16px);
  }
}

.event-rect {
  $size: 10px;
  width: $size;
  height: $size;
  transform: rotate(45deg);
  margin: 0 10px 0 0;
  border: 3px solid var(--event-color);
  background: linear-gradient(135deg, transparent 40%, var(--event-color) 40%);
}

.severity-info {
  margin: 5px 0 0 0;
  color: #333;
  font-weight: 300;
}

.empty-legend-message {
  height: 150px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: #333;
  gap: 5px;
  font-weight: 300;
}

.empty-legend-message-title {
  display: flex;
  align-items: center;
  gap: 5px;
  font-weight: 600;
}

.collapse-button-anchor {
  position: absolute;
  top: 0;
  right: 0px;
  .collapse-button {
    $size: 15px;
    position: absolute;
    bottom: 0px;
    right: 0px;
    width: $size;
    height: $size;
    color: white;
    background-color: mat.m2-get-color-from-palette(
      mat.$m2-indigo-palette,
      600
    );
    padding: 5px;
    mat-icon {
      @include common.adjust-mat-icon-size($size);
    }
    &:hover {
      background-color: mat.m2-get-color-from-palette(
        mat.$m2-indigo-palette,
        400
      );
      cursor: pointer;
    }
  }
}

.collapsed-message {
  display: flex;
  justify-content: center;
  align-items: center;
  color: #333;
  gap: 5px;
  font-weight: 300;
  &:hover {
    cursor: pointer;
  }
}
